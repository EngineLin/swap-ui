import React, { useEffect, useState } from "react";
import styled from "styled-components";
import { LineShareButton } from "react-share";

import { SWAPShareProps } from "./SWAPShare.types";

const SWAPShare: React.FC<SWAPShareProps> = ({
  url,
  size = 36,
  emailSubject = "",
  sharedContent = "",
}) => {
  const [sharedUrl, setSharedUrl] = useState("");

  useEffect(() => {
    if (url && url.length > 0) {
      setSharedUrl(url);
    } else {
      setSharedUrl(window.location.href);
    }
  }, []);

  const handleEmailOnClick = () => {
    /**
     * Relative issue: https://github.com/nygardk/react-share/issues/292
     */
    const email = encodeURI(`mailto:
    ?subject=${emailSubject}&body=${sharedContent}\n\n${sharedUrl}`);
    window.location.href = email;
  };

  const handleMessengerOnClick = () => {
    /**
     * Relative issue
     * https://github.com/nygardk/react-share/issues/288
     * https://stackoverflow.com/questions/34675419/share-url-in-facebook-messenger-from-web#
     */
    const appId = 549090209290719;
    const mobileDevide = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    const mobile =
      "fb-messenger://share?link=" +
      encodeURIComponent(`${sharedUrl}`) +
      `&app_id=` +
      encodeURIComponent(appId);

    const desktop = `https://www.facebook.com/dialog/send?link=${encodeURIComponent(
      sharedUrl
    )}&redirect_uri=${encodeURIComponent(sharedUrl)}&app_id=${appId}`;
    window.open(mobileDevide ? mobile : desktop, "_blank");
  };

  return (
    <SWAPShareWrap>
      {[
        {
          el: (
            <div
              className="swap_share_icon"
              onClick={() => handleMessengerOnClick()}
            >
              <svg
                width="40"
                height="40"
                viewBox="0 0 40 40"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                style={{ position: "absolute", left: 0, top: 0 }}
              >
                <path
                  d="M0 10C0 4.47715 4.47715 0 10 0H30C35.5228 0 40 4.47715 40 10V30C40 35.5228 35.5228 40 30 40H10C4.47715 40 0 35.5228 0 30V10Z"
                  fill="#ECECEC"
                />
                <path
                  d="M19.9999 10C14.3599 10 9.99988 14.13 9.99988 19.7C9.99988 22.61 11.1899 25.14 13.1399 26.87C13.2999 27 13.3999 27.22 13.4099 27.44L13.4599 29.22C13.4999 29.79 14.0699 30.16 14.5899 29.93L16.5699 29.06C16.7399 29 16.9299 28.97 17.0999 29C17.9999 29.27 18.9999 29.4 19.9999 29.4C25.6399 29.4 29.9999 25.27 29.9999 19.7C29.9999 14.13 25.6399 10 19.9999 10ZM25.9999 17.46L23.0699 22.13C22.5999 22.86 21.5999 23.05 20.8999 22.5L18.5599 20.77C18.3499 20.61 18.0499 20.61 17.8399 20.77L14.6799 23.17C14.2599 23.5 13.7099 23 13.9999 22.54L16.9299 17.87C17.3999 17.14 18.3999 16.95 19.0999 17.47L21.4399 19.23C21.6599 19.39 21.9499 19.39 22.1599 19.23L25.3199 16.83C25.7399 16.5 26.2899 17 25.9999 17.46Z"
                  fill="#6F6F6F"
                />
              </svg>
            </div>
          ),
        },
        {
          el: (
            <LineShareButton url={sharedUrl} title={sharedContent}>
              <svg
                width="40"
                height="40"
                viewBox="0 0 40 40"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                style={{ position: "absolute", left: 48, top: 0 }}
              >
                <path
                  d="M0 10C0 4.47715 4.47715 0 10 0H30C35.5228 0 40 4.47715 40 10V30C40 35.5228 35.5228 40 30 40H10C4.47715 40 0 35.5228 0 30V10Z"
                  fill="#ECECEC"
                />
                <path
                  d="M10 20C10 14.4772 14.4772 10 20 10C25.5228 10 30 14.4772 30 20C30 25.5228 25.5228 30 20 30C14.4772 30 10 25.5228 10 20Z"
                  fill="#6F6F6F"
                />
                <path
                  d="M20.1666 14.667C16.7666 14.667 14 16.8957 14 19.6352C14 22.0912 16.1938 24.148 19.1573 24.5369C19.3581 24.5799 19.6314 24.6683 19.7006 24.8388C19.7628 24.9936 19.7413 25.236 19.7205 25.3924C19.7205 25.3924 19.6481 25.8244 19.6325 25.9164C19.6057 26.0712 19.5086 26.5218 20.1666 26.2464C20.8248 25.9711 23.718 24.1704 25.0118 22.6919C25.9053 21.719 26.3333 20.7316 26.3333 19.6352C26.3333 16.8957 23.5671 14.667 20.1666 14.667Z"
                  fill="white"
                />
                <path
                  d="M18.4525 18.3335C18.3868 18.3335 18.3334 18.3886 18.3334 18.4564V21.2106C18.3334 21.2785 18.3868 21.3335 18.4525 21.3335H18.881C18.9468 21.3335 19 21.2785 19 21.2106V18.4564C19 18.3886 18.9468 18.3335 18.881 18.3335H18.4525Z"
                  fill="#6F6F6F"
                />
                <path
                  d="M21.8746 18.3335H21.4235C21.3543 18.3335 21.2982 18.3886 21.2982 18.4564V20.0927L20.014 18.3881C20.011 18.3838 20.0077 18.3797 20.0042 18.3757L20.0034 18.3749C20.0009 18.3722 19.9984 18.3697 19.9958 18.3673C19.9951 18.3666 19.9944 18.366 19.9935 18.3652C19.9914 18.3633 19.9892 18.3615 19.9868 18.3598C19.9859 18.3588 19.9848 18.3581 19.9836 18.3572C19.9814 18.3558 19.9793 18.3542 19.9771 18.3529C19.9759 18.352 19.9746 18.3513 19.9733 18.3507C19.9711 18.3494 19.9688 18.348 19.9666 18.3469C19.9653 18.3463 19.964 18.3456 19.9627 18.3451C19.9603 18.344 19.958 18.3429 19.9555 18.3421C19.9541 18.3416 19.9528 18.3411 19.9515 18.3406C19.949 18.3398 19.9465 18.3389 19.9439 18.3383C19.9426 18.3379 19.9411 18.3376 19.9396 18.3371C19.9372 18.3366 19.9348 18.336 19.9325 18.3356C19.9307 18.3353 19.9289 18.3351 19.9272 18.335C19.925 18.3345 19.9227 18.3343 19.9205 18.3341C19.9184 18.3339 19.9163 18.3339 19.9141 18.3337C19.9125 18.3337 19.9113 18.3335 19.9097 18.3335H19.4586C19.3895 18.3335 19.3333 18.3886 19.3333 18.4564V21.2106C19.3333 21.2785 19.3895 21.3335 19.4586 21.3335H19.9097C19.979 21.3335 20.0351 21.2785 20.0351 21.2106V19.5748L21.3209 21.2815C21.3298 21.2939 21.3408 21.3039 21.3527 21.3119C21.3531 21.3122 21.3536 21.3125 21.354 21.3129C21.3566 21.3145 21.3591 21.316 21.3617 21.3175C21.363 21.3182 21.3641 21.3187 21.3653 21.3193C21.3672 21.3204 21.3693 21.3214 21.3712 21.3222C21.3733 21.3231 21.3752 21.3239 21.3774 21.3248C21.3786 21.3253 21.3799 21.3257 21.3811 21.3261C21.3841 21.3272 21.3868 21.328 21.3896 21.3289C21.3902 21.3289 21.3908 21.3291 21.3914 21.3293C21.4017 21.3319 21.4124 21.3335 21.4235 21.3335H21.8746C21.9439 21.3335 21.9999 21.2785 21.9999 21.2106V18.4564C21.9999 18.3886 21.9439 18.3335 21.8746 18.3335Z"
                  fill="#6F6F6F"
                />
                <path
                  d="M17.8782 20.6438H16.6837V18.4566C16.6837 18.3886 16.6291 18.3335 16.5618 18.3335H16.1221C16.0547 18.3335 16 18.3886 16 18.4566V21.2103V21.2105C16 21.2436 16.0131 21.2735 16.0341 21.2956C16.0346 21.2962 16.0351 21.2968 16.0358 21.2974C16.0364 21.298 16.037 21.2985 16.0376 21.2991C16.0596 21.3204 16.0891 21.3335 16.1219 21.3335H17.8782C17.9456 21.3335 18 21.2782 18 21.2103V20.7669C18 20.6989 17.9456 20.6438 17.8782 20.6438Z"
                  fill="#6F6F6F"
                />
                <path
                  d="M24.2115 19.0232C24.2789 19.0232 24.3334 18.9682 24.3334 18.9001V18.4567C24.3334 18.3887 24.2789 18.3335 24.2115 18.3335H22.4554H22.4552C22.4223 18.3335 22.3926 18.3468 22.3706 18.3683C22.3701 18.3688 22.3695 18.3691 22.3692 18.3696C22.3685 18.3703 22.3679 18.3711 22.3673 18.3718C22.3463 18.3938 22.3334 18.4236 22.3334 18.4566V18.4567V21.2104V21.2105C22.3334 21.2436 22.3465 21.2735 22.3675 21.2956C22.368 21.2962 22.3686 21.2969 22.3692 21.2974C22.3697 21.298 22.3704 21.2986 22.371 21.2991C22.3928 21.3203 22.4225 21.3335 22.4552 21.3335H24.2115C24.2789 21.3335 24.3334 21.2782 24.3334 21.2104V20.7669C24.3334 20.6991 24.2789 20.6438 24.2115 20.6438H23.0172V20.1783H24.2115C24.2789 20.1783 24.3334 20.1231 24.3334 20.0552V19.6118C24.3334 19.5438 24.2789 19.4886 24.2115 19.4886H23.0172V19.0232H24.2115Z"
                  fill="#6F6F6F"
                />
              </svg>
            </LineShareButton>
          ),
        },
        {
          el: (
            <div className="swap_share_icon" onClick={handleEmailOnClick}>
              <svg
                width="40"
                height="40"
                viewBox="0 0 40 40"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                style={{ position: "absolute", left: 96, top: 0 }}
              >
                <path
                  d="M0 10C0 4.47715 4.47715 0 10 0H30C35.5228 0 40 4.47715 40 10V30C40 35.5228 35.5228 40 30 40H10C4.47715 40 0 35.5228 0 30V10Z"
                  fill="#ECECEC"
                />
                <path
                  d="M28 16L20 21L12 16V14L20 19L28 14V16ZM28 12H12C10.89 12 10 12.89 10 14V26C10 26.5304 10.2107 27.0391 10.5858 27.4142C10.9609 27.7893 11.4696 28 12 28H28C28.5304 28 29.0391 27.7893 29.4142 27.4142C29.7893 27.0391 30 26.5304 30 26V14C30 12.89 29.1 12 28 12Z"
                  fill="#6F6F6F"
                />
              </svg>
            </div>
          ),
        },
      ].map((item, index) => (
        <div key={`share_btn_${index}`}>{item.el}</div>
      ))}
    </SWAPShareWrap>
  );
};

const SWAPShareWrap = styled.div`
  height: 40px;
  position: relative;
  .swap_share_icon {
    cursor: pointer;
  }
`;

export default SWAPShare;
